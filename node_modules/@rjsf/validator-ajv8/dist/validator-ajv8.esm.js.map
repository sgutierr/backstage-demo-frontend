{"version":3,"file":"validator-ajv8.esm.js","sources":["../src/createAjvInstance.ts","../src/validator.ts","../src/customizeValidator.ts","../src/index.ts"],"sourcesContent":["import Ajv, { Options } from 'ajv';\nimport addFormats, { FormatsPluginOptions } from 'ajv-formats';\nimport isObject from 'lodash/isObject';\n\nimport { CustomValidatorOptionsType } from './types';\nimport { ADDITIONAL_PROPERTY_FLAG, RJSF_ADDITONAL_PROPERTIES_FLAG } from '@rjsf/utils';\n\nexport const AJV_CONFIG: Options = {\n  allErrors: true,\n  multipleOfPrecision: 8,\n  strict: false,\n  verbose: true,\n} as const;\nexport const COLOR_FORMAT_REGEX =\n  /^(#?([0-9A-Fa-f]{3}){1,2}\\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\\(\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*,\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*,\\s*\\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\\b\\s*\\))|(rgb\\(\\s*(\\d?\\d%|100%)+\\s*,\\s*(\\d?\\d%|100%)+\\s*,\\s*(\\d?\\d%|100%)+\\s*\\)))$/;\nexport const DATA_URL_FORMAT_REGEX = /^data:([a-z]+\\/[a-z0-9-+.]+)?;(?:name=(.*);)?base64,(.*)$/;\n\n/** Creates an Ajv version 8 implementation object with standard support for the 'color` and `data-url` custom formats.\n * If `additionalMetaSchemas` are provided then the Ajv instance is modified to add each of the meta schemas in the\n * list. If `customFormats` are provided then those additional formats are added to the list of supported formats. If\n * `ajvOptionsOverrides` are provided then they are spread on top of the default `AJV_CONFIG` options when constructing\n * the `Ajv` instance. With Ajv v8, the JSON Schema formats are not provided by default, but can be plugged in. By\n * default, all formats from the `ajv-formats` library are added. To disable this capability, set the `ajvFormatOptions`\n * parameter to `false`. Additionally, you can configure the `ajv-formats` by providing a custom set of\n * [format options](https://github.com/ajv-validator/ajv-formats) to the `ajvFormatOptions` parameter.\n *\n * @param [additionalMetaSchemas] - The list of additional meta schemas that the validator can access\n * @param [customFormats] - The set of additional custom formats that the validator will support\n * @param [ajvOptionsOverrides={}] - The set of validator config override options\n * @param [ajvFormatOptions] - The `ajv-format` options to use when adding formats to `ajv`; pass `false` to disable it\n * @param [AjvClass] - The `Ajv` class to use when creating the validator instance\n */\nexport default function createAjvInstance(\n  additionalMetaSchemas?: CustomValidatorOptionsType['additionalMetaSchemas'],\n  customFormats?: CustomValidatorOptionsType['customFormats'],\n  ajvOptionsOverrides: CustomValidatorOptionsType['ajvOptionsOverrides'] = {},\n  ajvFormatOptions?: FormatsPluginOptions | false,\n  AjvClass: typeof Ajv = Ajv\n) {\n  const ajv = new AjvClass({ ...AJV_CONFIG, ...ajvOptionsOverrides });\n  if (ajvFormatOptions) {\n    addFormats(ajv, ajvFormatOptions);\n  } else if (ajvFormatOptions !== false) {\n    addFormats(ajv);\n  }\n\n  // add custom formats\n  ajv.addFormat('data-url', DATA_URL_FORMAT_REGEX);\n  ajv.addFormat('color', COLOR_FORMAT_REGEX);\n\n  // Add RJSF-specific additional properties keywords so Ajv doesn't report errors if strict is enabled.\n  ajv.addKeyword(ADDITIONAL_PROPERTY_FLAG);\n  ajv.addKeyword(RJSF_ADDITONAL_PROPERTIES_FLAG);\n\n  // add more schemas to validate against\n  if (Array.isArray(additionalMetaSchemas)) {\n    ajv.addMetaSchema(additionalMetaSchemas);\n  }\n\n  // add more custom formats to validate against\n  if (isObject(customFormats)) {\n    Object.keys(customFormats).forEach((formatName) => {\n      ajv.addFormat(formatName, customFormats[formatName]);\n    });\n  }\n\n  return ajv;\n}\n","import Ajv, { ErrorObject, ValidateFunction } from 'ajv';\nimport get from 'lodash/get';\nimport {\n  createErrorHandler,\n  CustomValidator,\n  ErrorSchema,\n  ErrorTransformer,\n  FormContextType,\n  getDefaultFormState,\n  getUiOptions,\n  PROPERTIES_KEY,\n  RJSFSchema,\n  RJSFValidationError,\n  ROOT_SCHEMA_PREFIX,\n  StrictRJSFSchema,\n  toErrorList,\n  toErrorSchema,\n  UiSchema,\n  unwrapErrorHandler,\n  ValidationData,\n  validationDataMerge,\n  ValidatorType,\n  withIdRefPrefix,\n} from '@rjsf/utils';\n\nimport { CustomValidatorOptionsType, Localizer } from './types';\nimport createAjvInstance from './createAjvInstance';\n\n/** `ValidatorType` implementation that uses the AJV 8 validation mechanism.\n */\nexport default class AJV8Validator<T = any, S extends StrictRJSFSchema = RJSFSchema, F extends FormContextType = any>\n  implements ValidatorType<T, S, F>\n{\n  /** The AJV instance to use for all validations\n   *\n   * @private\n   */\n  private ajv: Ajv;\n\n  /** The Localizer function to use for localizing Ajv errors\n   *\n   * @private\n   */\n  readonly localizer?: Localizer;\n\n  /** Constructs an `AJV8Validator` instance using the `options`\n   *\n   * @param options - The `CustomValidatorOptionsType` options that are used to create the AJV instance\n   * @param [localizer] - If provided, is used to localize a list of Ajv `ErrorObject`s\n   */\n  constructor(options: CustomValidatorOptionsType, localizer?: Localizer) {\n    const { additionalMetaSchemas, customFormats, ajvOptionsOverrides, ajvFormatOptions, AjvClass } = options;\n    this.ajv = createAjvInstance(additionalMetaSchemas, customFormats, ajvOptionsOverrides, ajvFormatOptions, AjvClass);\n    this.localizer = localizer;\n  }\n\n  /** Converts an `errorSchema` into a list of `RJSFValidationErrors`\n   *\n   * @param errorSchema - The `ErrorSchema` instance to convert\n   * @param [fieldPath=[]] - The current field path, defaults to [] if not specified\n   * @deprecated - Use the `toErrorList()` function provided by `@rjsf/utils` instead. This function will be removed in\n   *        the next major release.\n   */\n  toErrorList(errorSchema?: ErrorSchema<T>, fieldPath: string[] = []) {\n    return toErrorList(errorSchema, fieldPath);\n  }\n\n  /** Transforming the error output from ajv to format used by @rjsf/utils.\n   * At some point, components should be updated to support ajv.\n   *\n   * @param errors - The list of AJV errors to convert to `RJSFValidationErrors`\n   * @param [uiSchema] - An optional uiSchema that is passed to `transformErrors` and `customValidate`\n   * @protected\n   */\n  protected transformRJSFValidationErrors(\n    errors: ErrorObject[] = [],\n    uiSchema?: UiSchema<T, S, F>\n  ): RJSFValidationError[] {\n    return errors.map((e: ErrorObject) => {\n      const { instancePath, keyword, params, schemaPath, parentSchema, ...rest } = e;\n      let { message = '' } = rest;\n      let property = instancePath.replace(/\\//g, '.');\n      let stack = `${property} ${message}`.trim();\n\n      if ('missingProperty' in params) {\n        property = property ? `${property}.${params.missingProperty}` : params.missingProperty;\n        const currentProperty: string = params.missingProperty;\n        const uiSchemaTitle = getUiOptions(get(uiSchema, `${property.replace(/^\\./, '')}`)).title;\n\n        if (uiSchemaTitle) {\n          message = message.replace(currentProperty, uiSchemaTitle);\n        } else {\n          const parentSchemaTitle = get(parentSchema, [PROPERTIES_KEY, currentProperty, 'title']);\n\n          if (parentSchemaTitle) {\n            message = message.replace(currentProperty, parentSchemaTitle);\n          }\n        }\n\n        stack = message;\n      } else {\n        const uiSchemaTitle = getUiOptions<T, S, F>(get(uiSchema, `${property.replace(/^\\./, '')}`)).title;\n\n        if (uiSchemaTitle) {\n          stack = `'${uiSchemaTitle}' ${message}`.trim();\n        } else {\n          const parentSchemaTitle = parentSchema?.title;\n\n          if (parentSchemaTitle) {\n            stack = `'${parentSchemaTitle}' ${message}`.trim();\n          }\n        }\n      }\n\n      // put data in expected format\n      return {\n        name: keyword,\n        property,\n        message,\n        params, // specific to ajv\n        stack,\n        schemaPath,\n      };\n    });\n  }\n\n  /** Runs the pure validation of the `schema` and `formData` without any of the RJSF functionality. Provided for use\n   * by the playground. Returns the `errors` from the validation\n   *\n   * @param schema - The schema against which to validate the form data   * @param schema\n   * @param formData - The form data to validate\n   */\n  rawValidation<Result = any>(schema: RJSFSchema, formData?: T): { errors?: Result[]; validationError?: Error } {\n    let compilationError: Error | undefined = undefined;\n    let compiledValidator: ValidateFunction | undefined;\n    if (schema['$id']) {\n      compiledValidator = this.ajv.getSchema(schema['$id']);\n    }\n    try {\n      if (compiledValidator === undefined) {\n        compiledValidator = this.ajv.compile(schema);\n      }\n      compiledValidator(formData);\n    } catch (err) {\n      compilationError = err as Error;\n    }\n\n    let errors;\n    if (compiledValidator) {\n      if (typeof this.localizer === 'function') {\n        this.localizer(compiledValidator.errors);\n      }\n      errors = compiledValidator.errors || undefined;\n\n      // Clear errors to prevent persistent errors, see #1104\n      compiledValidator.errors = null;\n    }\n\n    return {\n      errors: errors as unknown as Result[],\n      validationError: compilationError,\n    };\n  }\n\n  /** This function processes the `formData` with an optional user contributed `customValidate` function, which receives\n   * the form data and a `errorHandler` function that will be used to add custom validation errors for each field. Also\n   * supports a `transformErrors` function that will take the raw AJV validation errors, prior to custom validation and\n   * transform them in what ever way it chooses.\n   *\n   * @param formData - The form data to validate\n   * @param schema - The schema against which to validate the form data\n   * @param [customValidate] - An optional function that is used to perform custom validation\n   * @param [transformErrors] - An optional function that is used to transform errors after AJV validation\n   * @param [uiSchema] - An optional uiSchema that is passed to `transformErrors` and `customValidate`\n   */\n  validateFormData(\n    formData: T | undefined,\n    schema: S,\n    customValidate?: CustomValidator<T, S, F>,\n    transformErrors?: ErrorTransformer<T, S, F>,\n    uiSchema?: UiSchema<T, S, F>\n  ): ValidationData<T> {\n    const rawErrors = this.rawValidation<ErrorObject>(schema, formData);\n    const { validationError: invalidSchemaError } = rawErrors;\n    let errors = this.transformRJSFValidationErrors(rawErrors.errors, uiSchema);\n\n    if (invalidSchemaError) {\n      errors = [...errors, { stack: invalidSchemaError!.message }];\n    }\n    if (typeof transformErrors === 'function') {\n      errors = transformErrors(errors, uiSchema);\n    }\n\n    let errorSchema = toErrorSchema<T>(errors);\n\n    if (invalidSchemaError) {\n      errorSchema = {\n        ...errorSchema,\n        $schema: {\n          __errors: [invalidSchemaError!.message],\n        },\n      };\n    }\n\n    if (typeof customValidate !== 'function') {\n      return { errors, errorSchema };\n    }\n\n    // Include form data with undefined values, which is required for custom validation.\n    const newFormData = getDefaultFormState<T, S, F>(this, schema, formData, schema, true) as T;\n\n    const errorHandler = customValidate(newFormData, createErrorHandler<T>(newFormData), uiSchema);\n    const userErrorSchema = unwrapErrorHandler<T>(errorHandler);\n    return validationDataMerge<T>({ errors, errorSchema }, userErrorSchema);\n  }\n\n  /** Validates data against a schema, returning true if the data is valid, or\n   * false otherwise. If the schema is invalid, then this function will return\n   * false.\n   *\n   * @param schema - The schema against which to validate the form data\n   * @param formData - The form data to validate\n   * @param rootSchema - The root schema used to provide $ref resolutions\n   */\n  isValid(schema: S, formData: T | undefined, rootSchema: S) {\n    const rootSchemaId = rootSchema['$id'] ?? ROOT_SCHEMA_PREFIX;\n    try {\n      // add the rootSchema ROOT_SCHEMA_PREFIX as id.\n      // then rewrite the schema ref's to point to the rootSchema\n      // this accounts for the case where schema have references to models\n      // that lives in the rootSchema but not in the schema in question.\n      if (this.ajv.getSchema(rootSchemaId) === undefined) {\n        this.ajv.addSchema(rootSchema, rootSchemaId);\n      }\n      const schemaWithIdRefPrefix = withIdRefPrefix<S>(schema) as S;\n      let compiledValidator: ValidateFunction | undefined;\n      if (schemaWithIdRefPrefix['$id']) {\n        compiledValidator = this.ajv.getSchema(schemaWithIdRefPrefix['$id']);\n      }\n      if (compiledValidator === undefined) {\n        compiledValidator = this.ajv.compile(schemaWithIdRefPrefix);\n      }\n      const result = compiledValidator(formData);\n      return result as boolean;\n    } catch (e) {\n      console.warn('Error encountered compiling schema:', e);\n      return false;\n    } finally {\n      // TODO: A function should be called if the root schema changes so we don't have to remove and recompile the schema every run.\n      // make sure we remove the rootSchema from the global ajv instance\n      this.ajv.removeSchema(rootSchemaId);\n    }\n  }\n}\n","import { FormContextType, RJSFSchema, StrictRJSFSchema, ValidatorType } from '@rjsf/utils';\n\nimport { CustomValidatorOptionsType, Localizer } from './types';\nimport AJV8Validator from './validator';\n\n/** Creates and returns a customized implementation of the `ValidatorType` with the given customization `options` if\n * provided.\n *\n * @param [options={}] - The `CustomValidatorOptionsType` options that are used to create the `ValidatorType` instance\n * @param [localizer] - If provided, is used to localize a list of Ajv `ErrorObject`s\n */\nexport default function customizeValidator<\n  T = any,\n  S extends StrictRJSFSchema = RJSFSchema,\n  F extends FormContextType = any\n>(options: CustomValidatorOptionsType = {}, localizer?: Localizer): ValidatorType<T, S, F> {\n  return new AJV8Validator<T, S, F>(options, localizer);\n}\n","import customizeValidator from './customizeValidator';\n\nexport { customizeValidator };\nexport * from './types';\n\nexport default customizeValidator();\n"],"names":["AJV_CONFIG","allErrors","multipleOfPrecision","strict","verbose","COLOR_FORMAT_REGEX","DATA_URL_FORMAT_REGEX","createAjvInstance","additionalMetaSchemas","customFormats","ajvOptionsOverrides","ajvFormatOptions","AjvClass","Ajv","ajv","_extends","addFormats","addFormat","addKeyword","ADDITIONAL_PROPERTY_FLAG","RJSF_ADDITONAL_PROPERTIES_FLAG","Array","isArray","addMetaSchema","isObject","Object","keys","forEach","formatName","AJV8Validator","options","localizer","_proto","prototype","toErrorList","errorSchema","fieldPath","transformRJSFValidationErrors","errors","uiSchema","map","e","instancePath","keyword","params","schemaPath","parentSchema","rest","_objectWithoutPropertiesLoose","_excluded","_rest$message","message","property","replace","stack","trim","missingProperty","currentProperty","uiSchemaTitle","getUiOptions","get","title","parentSchemaTitle","PROPERTIES_KEY","name","rawValidation","schema","formData","compilationError","undefined","compiledValidator","getSchema","compile","err","validationError","validateFormData","customValidate","transformErrors","rawErrors","invalidSchemaError","concat","toErrorSchema","$schema","__errors","newFormData","getDefaultFormState","errorHandler","createErrorHandler","userErrorSchema","unwrapErrorHandler","validationDataMerge","isValid","rootSchema","_rootSchema$$id","rootSchemaId","ROOT_SCHEMA_PREFIX","addSchema","schemaWithIdRefPrefix","withIdRefPrefix","result","console","warn","removeSchema","customizeValidator"],"mappings":"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"}